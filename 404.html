<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>404 Not Found - はとあげマート</title>

  <link rel="stylesheet" href="/style.css">

  <!-- 404ページは検索エンジンにインデックスさせない -->
  <meta name="robots" content="noindex,follow">

  <meta name="description" content="美味しいはとあげを出来たてで提供する架空のコンビニ公式サイトの404エラーページです。">
  <meta name="keywords" content="わたあめえ, はとあげ, Fortnite, Discord, はと, 404, エラー">
  <meta name="author" content="はとあげマーケット">
  <link rel="canonical" href="https://hatoagemarket.wataamee777.f5.si/404.html">

  <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">

  <!-- OGP / Twitter -->
  <meta property="og:title" content="404 Not Found - はとあげマート">
  <meta property="og:description" content="お探しのページは見つかりませんでした。はとあげマートの公式サイトです。">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://hatoagemarket.wataamee777.f5.si/404.html">
  <meta property="og:image" content="https://hatoagemarket.wataamee777.f5.si/assets/logo.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://hatoagemarket.wataamee777.f5.si/assets/logo.png">

  <!-- Atatus（エラーモニタリング）を安全に遅延読み込み -->
  <script defer>
    (function() {
      var s = document.createElement('script');
      s.src = 'https://dmc1acwvwny3.cloudfront.net/atatus-spa.js';
      s.defer = true;
      s.onload = function() {
        try {
          if (window.atatus) {
            atatus.config('3b8a17d616d24583a30d41294ed01917').install();
          }
        } catch (e) {
          console.warn('Atatus init failed', e);
        }
      };
      s.onerror = function() {
        console.warn('Atatus script failed to load');
      };
      document.head.appendChild(s);
    })();
  </script>

  <script defer src="/script.js"></script>
</head>
<body>
  <a class="skip-link" href="#main" style="position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden;">
    本文へスキップ
  </a>

  <header role="banner">
    <div class="logo">
      <a href="/" aria-label="はとあげマート ホーム">
        <img src="/assets/logo.png" alt="はとあげマート ロゴ" width="180" height="60">
      </a>
    </div>

    <nav role="navigation" aria-label="グローバルナビゲーション">
      <ul>
        <li><a href="/">ホーム</a></li>
        <li><a href="/mail/">メールマガジン</a></li>
        <li><a href="/products/">商品一覧</a></li>
        <li><a href="https://discord.gg/B8rHDMug8P" target="_blank" rel="noopener noreferrer">お問い合わせ</a></li>
      </ul>
    </nav>
  </header>

  <main id="main" role="main" class="error-page">
    <section class="intro" aria-labelledby="page-title">
      <h1 id="page-title" tabindex="-1">404 Not Found</h1>
      <h2>お探しのページは見つかりませんでした</h2>
      <p>申し訳ございません。ご指定のURLは削除されたか、移動された可能性があります。URLの入力ミスもご確認ください。</p>
      <p>以下からお探しのページをお試しください。</p>
    </section>

    <div class="actions" style="margin:1em 0;">
      <button type="button" id="go-back" class="btn">前のページに戻る</button>
      <a href="/" class="btn" style="margin-left:0.5em;">トップページに戻る</a>
    </div>

    <div class="search-box" aria-label="サイト内検索">
      <!-- Google カスタム検索（そのまま利用） -->
      <script async src="https://cse.google.com/cse.js?cx=2030408b0f65e47be"></script>
      <div class="gcse-search"></div>
      <noscript>
        <form action="/" method="get" role="search" aria-label="サイト内検索（noscript）">
          <label for="simple-search" class="visually-hidden">サイト内検索</label>
          <input id="simple-search" name="q" type="search" placeholder="検索語を入力">
          <button type="submit">検索</button>
        </form>
      </noscript>
    </div>

    <section class="navigation-links" aria-label="便利リンク">
      <h3>便利リンク</h3>
      <ul>
        <li><a href="/products/">商品一覧</a></li>
        <li><a href="/mail/">メールマガジン</a></li>
        <li><a href="/sitemap.xml">サイトマップ</a></li>
        <li><a href="https://discord.gg/B8rHDMug8P" target="_blank" rel="noopener noreferrer">Discordで問い合わせ</a></li>
      </ul>
    </section>
  </main>

  <footer role="contentinfo">
    <p>© 2025 はとあげマート</p>
  </footer>

  <script>
    // フォーカスを h1 に移してスクリーンリーダーで読みやすくする
    document.getElementById('page-title')?.focus?.();

    // 「前のページに戻る」ボタンの挙動
    document.getElementById('go-back').addEventListener('click', function() {
      if (document.referrer && location.origin === new URL(document.referrer).origin) {
        // 同一オリジンの参照元がある場合は戻る
        history.length > 1 ? history.back() : location.href = '/';
      } else if (document.referrer) {
        // 外部からの遷移でreferrerがある場合は直接遷移
        location.href = document.referrer;
      } else {
        // 履歴が無ければトップへ
        location.href = '/';
      }
    });

    // 壊れたリンク報告フォームに現在のURLとreferrerをセット
    (function() {
      var brokenInput = document.getElementById('broken_url');
      var refInput = document.getElementById('referrer');
      if (brokenInput) brokenInput.value = location.href;
      if (refInput) refInput.value = document.referrer || '';
    })();

    // 非同期で報告を送る（fetch）。サーバー側で /report-broken-link を受け取る必要があります。
    document.getElementById('report-send-ajax').addEventListener('click', function() {
      var form = document.getElementById('report-form');
      var data = {
        broken_url: form.broken_url.value,
        referrer: form.referrer.value,
        comment: form.comment.value
      };
      var result = document.getElementById('report-result');
      result.textContent = '送信中...';
      fetch(form.action, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      }).then(function(res) {
        if (res.ok) {
          result.textContent = '報告を受け付けました。ご協力ありがとうございました。';
        } else {
          result.textContent = '送信に失敗しました（サーバーエラー）。後で再試行してください。';
        }
      }).catch(function(err) {
        console.error(err);
        result.textContent = '通信エラーが発生しました。ネットワークを確認してください。';
      });
    });

    // GA4: 404 イベントを送信（gtag が設定済みなら）
    (function() {
      try {
        if (window.gtag) {
          gtag('event', 'page_view', {
            'page_title': document.title,
            'page_path': location.pathname + location.search,
            'event_category': 'error',
            'event_label': '404'
          });
          // カスタムイベント
          gtag('event', '404_not_found', {
            'event_category': 'error',
            'event_label': location.href
          });
        }
      } catch (e) {
        // 任意：gtag が無くても動作に影響なし
        console.warn('gtag error', e);
      }
    })();
  </script>
</body>
</html>
